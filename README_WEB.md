# DRG分组器Web应用

🏥 **现代化的DRG诊断相关分组Web界面**

这是一个基于Flask开发的Web应用，为DRG分组器提供了友好的用户界面，让用户可以通过网页直接输入诊断信息进行DRG分组。

## ✨ 主要特性

- **🎨 现代化界面**：采用Bootstrap 5设计，响应式布局，支持移动端
- **⚡ 实时分组**：输入数据后即时进行DRG分组计算
- **🔍 数据验证**：前端和后端双重数据验证，确保输入准确性
- **📊 详细结果**：显示完整的分组过程和结果信息
- **🚀 易于部署**：使用uv工具管理依赖，一键启动

## 🛠️ 技术栈

- **后端**：Flask 3.1.2
- **前端**：HTML5 + CSS3 + JavaScript + Bootstrap 5
- **Python版本**：3.9+
- **包管理**：uv工具

## 🚀 快速开始

### 1. 环境准备

确保已安装uv工具：
```bash
# macOS/Linux
curl -LsSf https://astral.sh/uv/install.sh | sh

# Windows (PowerShell)
powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"
```

### 2. 启动应用

#### Linux/Mac系统：
```bash
./start_web.sh
```

#### Windows系统：
```cmd
start_web.cmd
```

### 3. 访问应用

在浏览器中打开：http://localhost:8080

## 📋 使用说明

### 输入字段说明

#### 患者基本信息
- **病案号** *（必填）*：病案的唯一标识符
- **性别** *（必填）*：1=男，2=女
- **年龄** *（必填）*：患者年龄（岁）
- **年龄天数**：年龄为0时必填
- **出生体重**：28天内新生儿必填

#### 住院信息
- **科室代码**：患者所在科室的代码
- **住院天数** *（必填）*：患者住院的总天数
- **离院方式** *（必填）*：
  - 1：医嘱离院
  - 2：医嘱转院
  - 3：医嘱转社区卫生服务机构/乡镇卫生院
  - 4：非医嘱离院
  - 5：死亡
  - 9：其他

#### 诊断和手术信息
- **诊断列表** *（必填）*：使用ICD-10标准编码，多个诊断用"|"分隔
- **手术操作列表**：使用ICD-9-CM-3标准编码，多个手术用"|"分隔

### 示例数据

病案号：22058878
性别：2（女）
年龄：88
年龄天数：32460
科室代码：13040503
住院天数：94
离院方式：1（医嘱离院）
诊断列表：K22.301|K11.901|E11.900|I10.x05
手术操作列表：96.0800x005

## 🔧 API接口

### POST /api/group
DRG分组接口

**请求参数：**
```json
{
  "index": "22058878",
  "gender": "2",
  "age": "88",
  "ageDay": "32460",
  "weight": "",
  "dept": "13040503",
  "inHospitalTime": "94",
  "leavingType": "1",
  "zdList": "K22.301|K11.901|E11.900|I10.x05",
  "ssList": "96.0800x005"
}
```

**响应结果：**
```json
{
  "success": true,
  "data": {
    "index": "22058878",
    "status": "分组成功",
    "mdc": "MDCG",
    "adrg": "GZ1",
    "drg": "GZ13",
    "messages": ["分组过程详细信息..."]
  }
}
```

### POST /api/validate
数据验证接口

**请求参数：** 同上
**响应结果：**
```json
{
  "success": true,
  "valid": false,
  "errors": ["错误信息列表..."]
}
```

## 🧪 测试

运行测试脚本验证应用功能：
```bash
uv run python test_app.py
```

## 📁 项目结构

```
DRG_Python/
├── app.py                 # Flask主应用
├── templates/
│   └── index.html        # 前端页面模板
├── test_app.py           # 测试脚本
├── start_web.sh          # Linux/Mac启动脚本
├── start_web.cmd         # Windows启动脚本
├── pyproject.toml        # 项目配置
├── requirements.txt      # 依赖列表
└── drg_group/           # DRG分组器核心模块
    ├── beijing_2022/    # 北京2022版分组器
    ├── chs_drg_11/      # CHS-DRG 1.1标准版
    └── ...              # 其他地区版本
```

## 🎯 分组结果说明

### MDC分类（主要诊断大类）
- **MDCA-MDCZ**：26个主要诊断大类
- 例如：MDCG = 肝胆胰疾病

### DRG组编号规则
- **第1位**：MDC字母（A-Z）
- **第2-3位**：ADRG组号（A1-Z9）
- **第4位**：严重程度
  - **1**: 伴严重并发症或合并症（MCC）
  - **3**: 伴并发症或合并症（CC）
  - **5**: 不伴并发症或合并症
  - **9**: 特殊情况

## ⚠️ 注意事项

1. **编码规范**：
   - 诊断编码必须使用ICD-10标准
   - 手术编码必须使用ICD-9-CM-3标准

2. **数据质量**：
   - 主诊断准确性直接影响MDC分组
   - 并发症诊断影响最终DRG严重程度分级

3. **性能考虑**：
   - 单条分组通常在1-5毫秒内完成
   - 支持并发访问

## 🐛 故障排除

### 常见问题

1. **模块导入失败**
   ```
   解决方案：确保drg_group目录完整，包含所有必要的.py和.dat文件
   ```

2. **Flask启动失败**
   ```
   解决方案：检查Python版本（需要3.9+），重新安装依赖
   ```

3. **分组失败**
   ```
   解决方案：检查输入的ICD编码是否正确，确保诊断列表不为空
   ```

### 日志查看

应用运行时会在控制台显示详细的日志信息，包括：
- 请求处理状态
- 分组过程详情
- 错误信息

## 📞 技术支持

如果遇到问题，请：
1. 检查控制台错误信息
2. 运行测试脚本验证环境
3. 查看项目主README文档

## 📄 许可证

MIT License - 详见项目根目录LICENSE文件

---

*本Web应用基于OpenDRG项目开发，为医院信息系统提供现代化的DRG分组界面。*
